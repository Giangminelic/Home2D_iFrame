<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Home - ERA iFrame</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #000;
      color: white;
      text-align: center;
    }

    .house-container {
      position: relative;
      display: none;
    }

    .house-container.active {
      display: block;
    }

    .house-container img {
      width: 100%;
      height: auto;
      display: block;
      transition: filter 0.5s;
    }

    .button-container {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
    }

    .btn-light {
      background: rgb(218, 197, 182);
      color: #000;
    }

    .btn-go {
      background: rgb(193, 212, 227);
      color: #000;
    }

    .btn-pump {
      background: #6281bf;
      color: white;
    }

    .param-box {
      position: absolute;
      background: rgba(0, 0, 0, 0.6);
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 14px;
    }

    .temp {
      top: 25%;
      left: 5%;
    }

    .humi {
      top: 30%;
      left: 5%;
    }

    .press {
      top: 35%;
      left: 5%;
    }

    .soil {
      top: 50%;
      left: 10%;
    }

    .ozone {
      top: 50%;
      left: 50%;
    }

    .gas {
      top: 10%;
      left: 30%;
    }

    .motion {
      top: 20%;
      left: 60%;
    }
  </style>
</head>

<body>
  <!-- Outdoor -->
  <div class="house-container active" id="outdoor">
    <img src="outdoor.jpg" alt="Outdoor" id="outdoorImg">
    <div class="button-container">
      <button class="btn-light" id="lightButton" onclick="toggleButton()">Toggle Light</button>
      <button class="btn-go" onclick="goInside()">Go Inside</button>
    </div>
  </div>

  <!-- Indoor -->
  <div class="house-container" id="indoor">
    <img src="inhouse.jpg" alt="Indoor">
    <div class="param-box temp">üå°Ô∏è Temp: <span id="temperature">--</span> ¬∞C</div>
    <div class="param-box humi">üíß Humidity: <span id="humidity">--</span> %</div>
    <div class="param-box press">‚è±Ô∏è Pressure: <span id="pressure">--</span> kPa</div>
    <div class="param-box soil">üå± Soil: <span id="soil">--</span> %</div>
    <div class="param-box ozone">üåÄ Ozone: <span id="ozone">--</span> ppm</div>
    <div class="param-box gas">üî• Gas: <span id="gas">--</span></div>
    <div class="param-box motion">üö∂ Motion: <span id="motion">--</span></div>
    <div class="button-container">
      <button class="btn-pump" id="pumpButton" onclick="togglePump()">B·∫≠t m√°y b∆°m</button>
      <button class="btn-go" onclick="goOutside()">Go Outside</button>
    </div>
  </div>

  <!-- ERA Widget -->
  <script src="https://www.unpkg.com/@eohjsc/era-widget@1.1.3/src/index.js"></script>
  <script>
    const eraWidget = new EraWidget();

    const temp = document.getElementById("temperature");
    const humi = document.getElementById("humidity");
    const press = document.getElementById("pressure");
    const soil = document.getElementById("soil");
    const ozone = document.getElementById("ozone");
    const gas = document.getElementById("gas");
    const motion = document.getElementById("motion");
    const lightButton = document.getElementById("lightButton");
    const pumpButton = document.getElementById("pumpButton");
    const outdoorImg = document.getElementById("outdoorImg");

    let configTemp, configHumi, configPress, configSoil, configOzone, configGas, configMotion, configLight;
    let actionOn, actionOff, actionPumpOn, actionPumpOff;
    let statusLed = 0;
    let statusPump = 0;

    eraWidget.ready();
    mobileHeight(300);

    eraWidget.init({
      onConfiguration: (configuration) => {
        configTemp = configuration.realtime_configs[0];
        configHumi = configuration.realtime_configs[1];
        configPress = configuration.realtime_configs[2];
        configSoil = configuration.realtime_configs[3];
        configOzone = configuration.realtime_configs[4];
        configGas = configuration.realtime_configs[5];
        configMotion = configuration.realtime_configs[6];
        configLight = configuration.realtime_configs[7];
        actionOn = configuration.actions[0];
        actionOff = configuration.actions[1];
        actionPumpOn = configuration.actions[2];  // B·∫≠t m√°y b∆°m
        actionPumpOff = configuration.actions[3]; // T·∫Øt m√°y b∆°m
      },

      onValues: (values) => {
        if (configTemp) temp.textContent = values[configTemp.id].value;
        if (configHumi) humi.textContent = values[configHumi.id].value;
        if (configPress) press.textContent = values[configPress.id].value;
        if (configSoil) soil.textContent = values[configSoil.id].value;
        if (configOzone) ozone.textContent = values[configOzone.id].value;

        if (configGas) {
          const gasValue = values[configGas.id].value;
          gas.textContent = gasValue == 1 ? "Ph√°t hi·ªán kh√≠ gas" : "Kh√¥ng ph√°t hi·ªán kh√≠ gas";
        }

        if (configMotion) {
          const motionValue = values[configMotion.id].value;
          motion.textContent = motionValue == 1 ? "Ph√°t hi·ªán chuy·ªÉn ƒë·ªông" : "Kh√¥ng ph√°t hi·ªán chuy·ªÉn ƒë·ªông";
        }

        if (configLight) {
          const lightValue = values[configLight.id].value;
          if (statusLed !== lightValue) {
            statusLed = lightValue;
            toggleLight();
          }
        }
      },
    });

    function toggleLight() {
      if (statusLed) {
        outdoorImg.style.filter = "brightness(1)";
        lightButton.textContent = "T·∫Øt ƒë√®n";
      } else {
        outdoorImg.style.filter = "brightness(0.2)";
        lightButton.textContent = "B·∫≠t ƒë√®n";
      }
    }

    function toggleButton() {
      if (statusLed == 0) {
        eraWidget.triggerAction(actionOn.action, null);
      } else {
        eraWidget.triggerAction(actionOff.action, null);
      }
    }

    function togglePump() {
      if (statusPump == 0) {
        eraWidget.triggerAction(actionPumpOn.action, null);
        pumpButton.textContent = "T·∫Øt m√°y b∆°m";
        statusPump = 1;
      } else {
        eraWidget.triggerAction(actionPumpOff.action, null);
        pumpButton.textContent = "B·∫≠t m√°y b∆°m";
        statusPump = 0;
      }
    }

    function goInside() {
      document.getElementById("outdoor").classList.remove("active");
      document.getElementById("indoor").classList.add("active");
    }

    function goOutside() {
      document.getElementById("indoor").classList.remove("active");
      document.getElementById("outdoor").classList.add("active");
    }
  </script>
</body>

</html>
